.TH AUDIT 1 "Octobre 2025" "Version 1.0" "Manuel Utilisateur"
.SH NOM
3_audit \- outil d'audit système pour Linux
.SH SYNOPSIS
.B audit.rb
[\fIOPTIONS\fR]
.SH DESCRIPTION
.B audit.rb
est un script Ruby qui effectue un audit complet du système Linux. Il collecte et affiche des informations sur la configuration système, l'utilisation des ressources, le réseau, les utilisateurs, l'espace disque, les processus actifs, le trafic réseau et l'état des services.

Le script peut afficher les résultats en format texte (par défaut) ou en JSON, avec possibilité d'export vers un fichier.

.SH OPTIONS
.TP
.B \-o, \-\-output FORMAT
Définit le format de sortie. Valeurs acceptées : \fBtext\fR (par défaut) ou \fBjson\fR.
.TP
.B \-c, \-\-cpu_threshold SEUIL
Seuil d'utilisation CPU en pourcentage pour filtrer les processus. Par défaut : 5%.
Seuls les processus dépassant ce seuil seront affichés.
.TP
.B \-m, \-\-memory_threshold SEUIL
Seuil d'utilisation mémoire en pourcentage pour filtrer les processus. Par défaut : 5%.
Seuls les processus dépassant ce seuil seront affichés.
.TP
.B \-f, \-\-flux_min MIN
Flux réseau minimum en kilooctets (KB) pour l'analyse du trafic. Par défaut : 2 KB.
Seules les interfaces avec un trafic supérieur à ce seuil seront affichées.
.TP
.B \-s, \-\-services "service1 service2"
Liste des services systemd à vérifier, séparés par des espaces. 
Par défaut, les services \fBsshd\fR, \fBcron\fR et \fBdocker\fR sont vérifiés.
Exemple : \-s "apache2 mysql postgresql"
.TP
.B \-p, \-\-file CHEMIN
Chemin du fichier de sortie pour l'export JSON. Cette option nécessite que le format soit défini sur \fBjson\fR avec l'option \fB\-o json\fR.
.TP
.B \-h, \-\-help
Affiche le message d'aide et quitte le programme.

.SH INFORMATIONS COLLECTÉES
Le script collecte les informations suivantes :

.SS 1. Informations système
\- Nom de la machine (hostname)
.br
\- Distribution Linux
.br
\- Version du noyau

.SS 2. Ressources système
\- Temps de fonctionnement (uptime)
.br
\- Charge moyenne (load average sur 1, 5 et 15 minutes)
.br
\- Utilisation de la mémoire RAM (utilisée/disponible)
.br
\- Utilisation du swap (utilisé/disponible)

.SS 3. Interfaces réseau
Pour chaque interface réseau :
.br
\- Nom de l'interface
.br
\- Adresse MAC
.br
\- Adresses IPv4 (avec CIDR)
.br
\- Adresses IPv6 (avec CIDR)

.SS 4. Utilisateurs
\- Liste des utilisateurs humains (UID >= 1000)
.br
\- Liste des utilisateurs actuellement connectés

.SS 5. Espace disque
Pour chaque partition /dev/* :
.br
\- Nom de la partition
.br
\- Taille totale
.br
\- Espace utilisé
.br
\- Espace disponible
.br
\- Pourcentage disponible

.SS 6. Processus
\- Processus dépassant le seuil CPU défini
.br
\- Processus dépassant le seuil mémoire défini
.br
Pour chaque processus : PID, utilisateur, commande, %CPU, %MEM

.SS 7. Flux réseau
Analyse du trafic réseau en temps réel (nécessite \fBroot\fR) :
.br
\- Interface réseau
.br
\- Données envoyées (en KB)
.br
\- Données reçues (en KB)

.SS 8. Services systemd
État des services systemd spécifiés :
.br
\- Statut actif (active/inactive)
.br
\- Statut d'activation au démarrage (enabled/disabled)

.SH DÉPENDANCES
Le script nécessite les commandes système suivantes :
.PP
.B Obligatoires :
.br
\- uname, lsb_release, uptime, free, ip, grep, cut, awk, df, ps, who, systemctl
.PP
.B Optionnelles :
.br
\- nethogs (pour l'analyse du trafic réseau, nécessite les droits root)

.SH PRIVILÈGES
L'analyse du trafic réseau avec \fBnethogs\fR nécessite les privilèges root. 
Si le script est exécuté sans ces privilèges, un avertissement sera affiché mais les autres analyses fonctionneront normalement.

Pour exécuter avec les privilèges nécessaires :
.PP
.nf
.B sudo ./audit.rb
.fi

.SH EXEMPLES
.TP
Audit standard en format texte :
.nf
.B ./audit.rb
.fi

.TP
Audit avec seuils personnalisés :
.nf
.B ./audit.rb \-c 10 \-m 15 \-f 5
.fi
Affiche les processus utilisant plus de 10% CPU ou 15% mémoire, et le trafic réseau supérieur à 5 KB.

.TP
Vérifier des services spécifiques :
.nf
.B ./audit.rb \-s "apache2 mysql nginx postgresql"
.fi

.TP
Export en JSON vers stdout :
.nf
.B ./audit.rb \-o json
.fi

.TP
Export en JSON vers un fichier :
.nf
.B sudo ./audit.rb \-o json \-p /tmp/audit_$(date +%Y%m%d).json
.fi
Crée un fichier JSON avec horodatage.

.TP
Audit complet avec tous les paramètres :
.nf
.B sudo ./audit.rb \-o json \-p /var/log/audit.json \\
    \-c 8 \-m 10 \-f 3 \-s "sshd apache2 mysql docker"
.fi

.SH FORMAT JSON
Lorsque l'option \fB\-o json \-p fichier\fR est utilisée, le fichier JSON généré contient une structure complète avec :
.PP
.nf
{
  "timestamp": "Date et heure de l'audit",
  "system_info": { ... },
  "resources": { ... },
  "network_interfaces": [ ... ],
  "users": { ... },
  "disk_space": [ ... ],
  "processes": { ... },
  "network_flux": [ ... ],
  "services": { ... }
}
.fi

.SH CODES DE RETOUR
.TP
.B 0
Exécution réussie
.TP
.B 1
Erreur générale (commande manquante, erreur d'écriture de fichier, etc.)

.SH FICHIERS
.TP
.B /etc/passwd
Utilisé pour lister les utilisateurs humains
.TP
.B /proc/
Système de fichiers proc utilisé par diverses commandes (ps, free, etc.)

.SH VOIR AUSSI
.BR ps (1),
.BR free (1),
.BR df (1),
.BR ip (8),
.BR systemctl (1),
.BR nethogs (8),
.BR uptime (1)

.SH AUTEUR
Script d'audit système

.SH BOGUES
\- L'analyse du trafic réseau est limitée à 3 secondes par nethogs
.br
\- Certaines interfaces virtuelles peuvent afficher "N/A" pour l'adresse MAC
.br
\- Les services doivent être des unités systemd valides

Pour signaler un bogue, veuillez contacter l'administrateur système.

.SH COPYRIGHT
Ce script est fourni "tel quel" sans garantie d'aucune sorte.
